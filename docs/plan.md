# План разработки проекта

Этот план составлен на основе документации и описывает пошаговый процесс создания Backend API.

---

### 1. Настройка окружения и базовой структуры
- [ ] Создать корневую структуру директорий (`/api`, `/data`, `/files`, `/assets`) согласно `architecture.md`.
- [ ] В директории `/data` создать пустые JSON-файлы для всех ресурсов (`sites.json`, `labs.json`, `practices.json`, и т.д.).
- [ ] Создать базовые конфигурационные файлы в `/api/config/` (`auth.php` с хешем пароля, `paths.php` с путями к `/data` и `/files`).

---

### 2. Реализация ядра API (`/api/core`)
- [ ] Создать класс `Request.php` для обработки входящих данных (URI, метод, заголовки, тело запроса, файлы).
- [ ] Создать класс `Response.php` для формирования стандартизированных JSON-ответов (успех, ошибка, код состояния).
- [ ] Создать класс `Router.php`, который будет сопоставлять URI и метод запроса с действием контроллера.
- [ ] Создать класс `Auth.php` для реализации Basic-аутентификации.
- [ ] Создать класс `FileHelper.php` с методами для безопасной работы с файлами (загрузка, распаковка ZIP, проверка путей).
- [ ] Создать заготовку класса `Validator.php` для валидации данных по JSON-схемам.
- [ ] **(Дополнено)** Создать централизованный обработчик исключений для формирования стандартных JSON-ответов об ошибках (400, 401, 404 и т.д.).

---

### 3. Реализация обобщенного репозитория
- [ ] Создать класс `JsonRepository.php` в `/api/core/`, который будет инкапсулировать всю логику работы с JSON-файлами:
    - Чтение и запись файла с блокировкой (`LOCK_EX`).
    - Генерация уникального `id` при создании записи.
    - Методы для полного CRUD: `findAll`, `findById`, `create`, `update` (`PUT`), `delete`.
    - **(Дополнено)** Добавить метод `partialUpdate` для частичного обновления записи (для `PATCH` запросов).

---

### 4. Создание первого простого модуля (например, `drafts`)
- [ ] Создать структуру модуля `/api/modules/drafts/`.
- [ ] Создать `DraftsRepository.php`, использующий `JsonRepository`.
- [ ] Создать `DraftsService.php` (может быть пустым, если нет доп. логики).
- [ ] Создать `DraftsController.php` с реализацией всех CRUD-методов, включая `PATCH`.
- [ ] Создать `routes.php` для этого модуля, определив маршруты `/api/drafts` и `/api/drafts/{id}`.
- [ ] Подключить роуты модуля в главном файле `bootstrap.php`.

---

### 5. Создание модуля с загрузкой файлов (например, `labs`)
- [ ] Создать модуль `/api/modules/labs/` по аналогии с `drafts`.
- [ ] В `LabsController.php` добавить метод для обработки `POST /api/labs/{id}`.
- [ ] В `LabsService.php` реализовать логику:
    - Сохранение PDF-файла с помощью `FileHelper`.
    - Формирование публичного URL.
    - Обновление полей `fileName` и `url` в `labs.json` через репозиторий.

---

### 6. Создание сложного модуля (`sites`)
- [ ] Создать модуль `/api/modules/sites/` с полной CRUD-логикой для `sites.json`.
- [ ] **(Детализировано)** Реализовать загрузку и "семантическую" обработку ZIP-архива (`POST /api/sites/{id}`):
    - Сервис должен распаковать архив во временную директорию.
    - Просканировать распакованные файлы, найти `.html` страницы.
    - Автоматически сгенерировать массив `pages` в `sites.json` с публичными URL для каждой найденной страницы.
    - Переместить файлы в постоянную директорию `/files/sites/{slug}`.
- [ ] Реализовать эндпоинты для управления референсами:
    - `POST /api/sites/{id}/references` (добавление).
    - `PUT /api/sites/{id}/references/{fileName}` (замена).
    - `DELETE /api/sites/{id}/references/{fileName}` (удаление).
- [ ] В сервисе `SitesService.php` реализовать логику сохранения/удаления файлов референсов и обновления `references` в `sites.json`.

---

### 7. Завершение и финализация
- [ ] Реализовать все остальные модули (`works`, `pages`, и т.д.) по созданным шаблонам.
- [ ] Настроить главный файл `index.php` для передачи всех запросов в роутер.
- [ ] Провести полное тестирование всех эндпоинтов, включая проверку прав доступа и обработку ошибок.
