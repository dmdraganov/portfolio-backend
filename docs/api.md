# Спецификация API

## Общие сведения

- **Тип:** REST API
- **Базовый URL:** `/api/`
- **Формат:** JSON
- **Авторизация:** Basic Auth
- **Методы:** `GET`, `POST`, `PUT`, `DELETE`

---

## Основные ресурсы

Помимо загрузки файлов, API предоставляет стандартные CRUD-эндпоинты для всех основных моделей данных.

| Ресурс (Эндпоинт)         | JSON-файл                     | Описание                              |
| ------------------------- | ----------------------------- | ------------------------------------- |
| `/api/sites`              | `sites.json`                  | Управление сайтами                    |
| `/api/works`              | `labs.json`, `practices.json` | Управление учебными работами (ЛР, ПР) |
| `/api/pages`              | `practical-pages.json`        | Управление практическими страницами   |
| `/api/courseworks`        | `courseworks.json`            | Управление курсовыми работами         |
| `/api/essays`             | `essays.json`                 | Управление рефератами и эссе          |
| `/api/drafts`             | `drafts.json`                 | Управление черновиками                |
| `/api/compensatory-works` | `compensatory-works.json`     | Управление отработками                |

_Каждый ресурс поддерживает стандартные методы: `GET` (список), `GET /{id}` (один элемент), `POST` (создание), `PUT /{id}` (полное обновление), `DELETE /{id}` (удаление)._

---

## Загрузка контента ресурсов

#### PDF (для работ, курсовых и т.д.)

`POST /api/<resource_name>/{id}`

- **Пример:** `POST /api/labs/lab-1`
- **Тип:** `multipart/form-data`
- **Поле:** `file`
- Сервер автоматически определяет тип ресурса, сохраняет файл в соответствующую директорию (`/files/labs/`, `/files/courseworks/` и т.д.) и обновляет `url` и `fileName` в JSON-модели.

#### ZIP (архив с файлами сайта)

`POST /api/sites/{id}`

- **Тип:** `multipart/form-data`
- **Поле:** `file`
- Этот эндпоинт используется **только для загрузки архива с кодом сайта** (HTML, CSS, JS).
- Сервер распаковывает архив в директорию `/files/sites/{slug}/`.
- **Референсы (изображения-примеры) управляются отдельно.**

---

## Управление референсами сайта

Референсы — это изображения-примеры для страниц сайта. Они загружаются, обновляются и удаляются отдельно от основного архива сайта через специальные эндпоинты.

#### Добавление или замена референса

`POST /api/sites/{id}/references`
`PUT /api/sites/{id}/references/{fileName}`

- **Тип:** `multipart/form-data`
- **Поле:** `file` или несколько полей `file[]`
- **Метод `POST`** используется для добавления одного или нескольких новых референсов.
- **Метод `PUT`** используется для замены существующего референса с указанным `fileName`.
- Сервер сохраняет файлы в `/files/references/sites/{slug}/` и добавляет/обновляет соответствующие записи в массиве `references` в `sites.json`.

#### Удаление референса

`DELETE /api/sites/{id}/references/{fileName}`

- Удаляет указанный файл референса с сервера и соответствующую запись из `sites.json`.
- В качестве `{fileName}` используется имя файла, например, `header.png`.

---

## Коды ошибок

| Код | Описание                  |
| --- | ------------------------- |
| 400 | Неверный запрос           |
| 401 | Ошибка авторизации        |
| 403 | Доступ запрещён           |
| 404 | Ресурс не найден          |
| 409 | Конфликт данных           |
| 500 | Внутренняя ошибка сервера |
